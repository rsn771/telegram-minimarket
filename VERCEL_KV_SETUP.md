# Настройка Vercel KV для постоянного хранения отзывов

## Проблема

На Vercel файловая система доступна только для чтения, а `/tmp` очищается при каждом деплое. Это означает, что отзывы, сохраненные в SQLite, теряются при каждом обновлении.

## Решение

Используем **Vercel KV** для постоянного хранения отзывов на продакшене. Локально продолжаем использовать SQLite для удобной работы в SQLiteStudio.

## Шаги настройки

### 1. Создайте KV базу данных в Vercel

1. Откройте [Vercel Dashboard](https://vercel.com/dashboard)
2. Перейдите в ваш проект `telegram-minimarket`
3. Откройте вкладку **"Storage"** (Хранилище)
4. Нажмите **"Create Database"** (Создать базу данных)
5. Выберите **"KV"** (Key-Value)
6. Введите имя: `reviews-kv` (или любое другое)
7. Выберите регион (ближайший к вашим пользователям)
8. Нажмите **"Create"**

### 2. Подключите KV к проекту

После создания KV базы данных:

1. Vercel автоматически добавит переменные окружения в ваш проект:
   - `KV_REST_API_URL`
   - `KV_REST_API_TOKEN`
   - `KV_REST_API_READ_ONLY_TOKEN`

2. Эти переменные будут автоматически доступны в вашем коде через `process.env`

### 3. Установите пакет локально

```bash
cd /Users/artemluzanin/Desktop/telegram-minimarket
npm install
```

Пакет `@vercel/kv` уже добавлен в `package.json`.

### 4. Проверьте работу

После деплоя:

1. Откройте мини-приложение
2. Добавьте отзыв к любому приложению
3. Перезагрузите страницу — отзыв должен сохраниться
4. Сделайте новый деплой — отзывы должны остаться

## Как это работает

- **Локально**: Отзывы сохраняются в `database/reviews.db` (SQLite), можно редактировать в SQLiteStudio
- **На проде**: Отзывы сохраняются в Vercel KV (постоянное хранилище), данные сохраняются между деплоями

Код автоматически определяет окружение и использует нужное хранилище:
- Если `VERCEL=true` и есть `KV_REST_API_URL` → использует KV
- Иначе → использует SQLite

## Миграция существующих отзывов

Если у вас уже есть отзывы в локальной БД и вы хотите перенести их в KV:

1. Экспортируйте отзывы из SQLiteStudio в JSON
2. Создайте временный скрипт для импорта в KV (или используйте Vercel Dashboard → KV → Import)

## Важно

- **Локальная разработка**: Продолжайте работать с `database/reviews.db` в SQLiteStudio
- **Продакшен**: Отзывы автоматически сохраняются в KV и не теряются при деплоях
- **Рейтинги**: Автоматически пересчитываются из отзывов (из KV на проде, из SQLite локально)
